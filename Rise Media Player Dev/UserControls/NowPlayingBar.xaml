<UserControl
    x:Class="Rise.App.UserControls.NowPlayingBar"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Rise.App.UserControls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DesignHeight="300"
    d:DesignWidth="1000"
    d:DataContext="{d:DesignInstance Type=viewmodels:PlaybackViewModel}"
    xmlns:viewmodels="using:Rise.App.ViewModels"
    xmlns:ui="using:Microsoft.Toolkit.Uwp.UI"
    xmlns:media="using:Microsoft.Toolkit.Uwp.UI.Media"
    xmlns:controls="using:Microsoft.Toolkit.Uwp.UI.Controls"
    xmlns:converters="using:Rise.App.Converters"
    Height="102"
    MaxWidth="1500"
    SizeChanged="UserControl_SizeChanged">

    <UserControl.Resources>
        <media:AttachedCardShadow Offset="0,2" x:Name="DropShadow" CornerRadius="8" BlurRadius="25" Opacity=".15" />
        <media:AttachedCardShadow x:Name="EmptyDropShadow" Opacity="0" />
        <converters:BooleanToArtistColumnVisibility x:Key="BoolToVis" />
        <LinearGradientBrush x:Name="PlayBorderBrush">
            <GradientStop Color="#F98253" Offset="0.1"/>
            <GradientStop Color="#F98253"/>
            <GradientStop Color="#B61F9C" Offset="0.8"/>
        </LinearGradientBrush>
        <converters:DecimalPointToPercentageConverter x:Key="DecimalPointToPercentage" />
    </UserControl.Resources>

    <Border x:Name="Parent1" ui:Effects.Shadow="{x:Bind DropShadow}">
        <Grid x:Name="Grid" Padding="12,0"
              BorderThickness="1"
              CornerRadius="8"
              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
            <Grid.Background>
                <AcrylicBrush BackgroundSource="Backdrop"
                              x:Name="BackgroundAcrylicBrush"
                              TintOpacity="0.1"
                              TintColor="{StaticResource SystemColorBackgroundColor}" />
            </Grid.Background>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="{x:Bind IsArtistShown, Converter={StaticResource BoolToVis}, Mode=OneWay}" MaxWidth="230" x:Name="ArtistColumn" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width=".45*" x:Name="VolumeColumn" MaxWidth="200" />
            </Grid.ColumnDefinitions>

            <RelativePanel>
                <Border PointerReleased="AlbumArtContainer_PointerReleased"
                        x:Name="AlbumArtContainer"
                        RelativePanel.AlignVerticalCenterWithPanel="True"
                        Width="75"
                        Height="75"
                        CornerRadius="5"
                        ToolTipService.ToolTip="{Binding CurrentSong.Album}">
                    <Image x:Name="AlbumArt">
                        <Image.Source>
                            <BitmapImage UriSource="{Binding CurrentSong.Thumbnail, Mode=OneWay}" />
                        </Image.Source>
                    </Image>
                </Border>
                <StackPanel RelativePanel.AlignRightWithPanel="True" RelativePanel.AlignVerticalCenterWithPanel="True" RelativePanel.RightOf="AlbumArtContainer" Spacing="3" Margin="10,0,0,0">
                    <TextBlock MaxLines="1" HorizontalAlignment="Stretch" ToolTipService.ToolTip="{Binding CurrentSong.Title, Mode=OneWay}" Text="{Binding CurrentSong.Title, Mode=OneWay}" TextTrimming="CharacterEllipsis" FontSize="17" Style="{ThemeResource SubtitleTextBlockStyle}" FontWeight="SemiBold" x:Name="SongTitle" />
                    <TextBlock ToolTipService.ToolTip="{Binding CurrentSong.Artist, Mode=OneWay}" Text="{Binding CurrentSong.Artist, Mode=OneWay}" FontSize="15" TextTrimming="CharacterEllipsis" x:Name="SongArtist" />
                </StackPanel>
            </RelativePanel>

            <StackPanel Grid.Column="1" VerticalAlignment="Center" Padding="3,0,0,0">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <Button HorizontalAlignment="Right" x:Name="VolumeFlyoutButton1" BorderBrush="Transparent" Background="Transparent">
                        <Button.Flyout>
                            <Flyout>
                                <RelativePanel Width="200">
                                    <Viewbox Width="14" Height="14" RelativePanel.AlignVerticalCenterWithPanel="True" x:Name="VolumeIconViewBoxMediaControl2">
                                        <SymbolIcon Symbol="Volume" />
                                    </Viewbox>
                                    <Slider StepFrequency=".01" Maximum="1" IsThumbToolTipEnabled="False" x:Name="VolumeSlider2" Value="{x:Bind _player.Volume, Mode=TwoWay}" RelativePanel.LeftOf="VolumeProgressText2" RelativePanel.AlignVerticalCenterWithPanel="True" Margin="10,0" RelativePanel.RightOf="VolumeIconViewBoxMediaControl2" />
                                    <TextBlock Text="{x:Bind VolumeSlider2.Value, Converter={StaticResource DecimalPointToPercentage}, Mode=OneWay}" x:Name="VolumeProgressText2" RelativePanel.AlignRightWithPanel="True" RelativePanel.AlignVerticalCenterWithPanel="True" />
                                </RelativePanel>
                            </Flyout>
                        </Button.Flyout>
                        <FontIcon Glyph="&#xE767;" />
                    </Button>

                    <ToggleButton x:Name="ShuffleButton"
                            Background="Transparent"
                            BorderBrush="Transparent"
                            Click="ShuffleButton_Click"
                            ToolTipService.ToolTip="Shuffle list">
                        <FontIcon Glyph="&#xE8B1;" FontFamily="Assets/MediaPlayerIcons.ttf#Media Player Fluent Icons" />
                    </ToggleButton>

                    <Button ToolTipService.ToolTip="Back"
                            BorderBrush="Transparent"
                            Background="Transparent"
                            x:Name="PreviousButton"
                            Click="PreviousButton_Click">
                        <FontIcon Glyph="&#xE622;"
                                  FontSize="15"
                                  FontFamily="Assets/MediaPlayerIcons.ttf#Media Player Fluent Icons" />
                    </Button>

                    <Border Margin="5,0" CornerRadius="50" Height="50" Width="50" BorderThickness="4">
                        <Button PointerEntered="PlayButton_PointerEntered" PointerExited="PlayButton_PointerExited" Height="50" CornerRadius="50" BorderBrush="Transparent" Background="Transparent" Click="PlayButton_Click" x:Name="PlayButton">
                            <Button.Resources>
                                <ResourceDictionary>
                                    <ResourceDictionary.ThemeDictionaries>
                                        <ResourceDictionary x:Key="Dark">
                                            <LinearGradientBrush x:Key="ButtonForegroundPointerOver">
                                                <GradientStop Color="#F98253" Offset="0.1"/>
                                                <GradientStop Color="#F98253"/>
                                                <GradientStop Color="#B61F9C" Offset="0.8"/>
                                            </LinearGradientBrush>
                                        </ResourceDictionary>
                                        <ResourceDictionary x:Key="Light">
                                            <LinearGradientBrush x:Key="ButtonForegroundPointerOver">
                                                <GradientStop Color="#F98253" Offset="0.1"/>
                                                <GradientStop Color="#F98253"/>
                                                <GradientStop Color="#B61F9C" Offset="0.8"/>
                                            </LinearGradientBrush>
                                        </ResourceDictionary>
                                    </ResourceDictionary.ThemeDictionaries>
                                </ResourceDictionary>
                            </Button.Resources>
                            <FontIcon Glyph="&#xF5B0;" FontFamily="Assets/MediaPlayerIcons.ttf#Media Player Fluent Icons" FontSize="18" x:Name="PlayButtonIcon" />
                        </Button>
                    </Border>

                    <Button Click="NextButton_Click"
                            ToolTipService.ToolTip="Next"
                            BorderBrush="Transparent"
                            Background="Transparent"
                            x:Name="NextButton">
                        <FontIcon Glyph="&#xE623;"
                                  FontFamily="Assets/MediaPlayerIcons.ttf#Media Player Fluent Icons"
                                  FontSize="15"/>
                    </Button>

                    <ToggleButton x:Name="RepeatButton"
                            Background="Transparent"
                            BorderBrush="Transparent"
                            Click="RepeatButton_Click"
                            ToolTipService.ToolTip="Toggle repeat">
                        <FontIcon Glyph="&#xE8EE;" FontFamily="Assets/MediaPlayerIcons.ttf#Media Player Fluent Icons" />
                    </ToggleButton>

                    <Button x:Name="OverlayButton1"
                            Click="OverlayButton1_Click"
                            Background="Transparent"
                            BorderBrush="Transparent">
                        <FontIcon Glyph="&#xEE49;" FontFamily="Assets/MediaPlayerIcons.ttf#Media Player Fluent Icons" />
                    </Button>
                </StackPanel>
                <RelativePanel MaxWidth="400">
                    <TextBlock x:Name="MediaPlayingDurationLeft" RelativePanel.AlignVerticalCenterWithPanel="True" Text="0:00" Height="20" RelativePanel.AlignLeftWithPanel="True" />
                    <Slider PointerCaptureLost="SliderProgress_PointerCaptureLost" x:Name="SliderProgress" Padding="8,0,8,0" RelativePanel.RightOf="MediaPlayingDurationLeft" RelativePanel.LeftOf="MediaPlayingDurationRight" IsThumbToolTipEnabled="False" />
                    <TextBlock Text="0:00" x:Name="MediaPlayingDurationRight" Height="20" RelativePanel.AlignVerticalCenterWithPanel="True" RelativePanel.AlignRightWithPanel="True" />
                </RelativePanel>
            </StackPanel>

            <StackPanel Orientation="Vertical" VerticalAlignment="Center" Grid.Column="2" Padding="10,0,0,0">
                <controls:WrapPanel Margin="0,4,0,0" Orientation="Horizontal" HorizontalAlignment="Right">

                    <Button Height="35"
                            HorizontalAlignment="Right"
                            x:Name="VolumeFlyoutButton"
                            BorderBrush="Transparent"
                            BorderThickness="0"
                            Background="Transparent"
                            ToolTipService.ToolTip="Change volume">
                        <Button.Flyout>
                            <Flyout>
                                <RelativePanel Width="200">
                                    <Viewbox Width="14" Height="14" RelativePanel.AlignVerticalCenterWithPanel="True" x:Name="VolumeIconViewBoxMediaControl1">
                                        <SymbolIcon Symbol="Volume" />
                                    </Viewbox>
                                    <Slider StepFrequency=".01" Maximum="1" IsThumbToolTipEnabled="False" x:Name="VolumeSlider1" Value="{x:Bind _player.Volume, Mode=TwoWay}" RelativePanel.LeftOf="VolumeProgressText1" RelativePanel.AlignVerticalCenterWithPanel="True" Margin="10,0" RelativePanel.RightOf="VolumeIconViewBoxMediaControl1" />
                                    <TextBlock Text="{x:Bind VolumeSlider1.Value, Converter={StaticResource DecimalPointToPercentage}, Mode=OneWay}" x:Name="VolumeProgressText1" RelativePanel.AlignRightWithPanel="True" RelativePanel.AlignVerticalCenterWithPanel="True" />
                                </RelativePanel>
                            </Flyout>
                        </Button.Flyout>
                        <FontIcon Glyph="&#xE767;" />
                    </Button>

                    <Button x:Name="OverlayButton"
                            Click="OverlayButton_Click"
                            VerticalAlignment="Stretch"
                            Background="Transparent"
                            BorderBrush="Transparent"
                            BorderThickness="0"
                            Height="35">
                        <FontIcon Glyph="&#xEE49;" FontFamily="Assets/MediaPlayerIcons.ttf#Media Player Fluent Icons" />
                    </Button>

                    <Button x:Name="RestoreVideoButton"
                            VerticalAlignment="Stretch"
                            Background="Transparent"
                            BorderBrush="Transparent"
                            BorderThickness="0"
                            Height="35"
                            ToolTipService.ToolTip="Restore video"
                            Click="RestoreVideoButton_Click"
                            Visibility="Collapsed">
                        <FontIcon Glyph="&#xE740;" FontFamily="Assets/MediaPlayerIcons.ttf#Media Player Fluent Icons" />
                    </Button>

                    <Button BorderBrush="Transparent"
                            Background="Transparent"
                            BorderThickness="0"
                            Height="35">
                        <Viewbox Width="18" Height="18">
                            <SymbolIcon Symbol="More" />
                        </Viewbox>
                    </Button>
                </controls:WrapPanel>
                <RelativePanel Margin="0,10,0,0" x:Name="DefaultVolumeControl">
                    <Viewbox Width="14" Height="14" RelativePanel.AlignVerticalCenterWithPanel="True" x:Name="VolumeIconViewBoxMediaControl">
                        <SymbolIcon Symbol="Volume" />
                    </Viewbox>
                    <Slider StepFrequency=".01" Maximum="1" IsThumbToolTipEnabled="False" x:Name="VolumeSlider" Value="{x:Bind _player.Volume, Mode=TwoWay}" RelativePanel.LeftOf="VolumeProgressText" RelativePanel.AlignVerticalCenterWithPanel="True" Margin="10,0,10,0" RelativePanel.RightOf="VolumeIconViewBoxMediaControl" />
                    <TextBlock Text="{x:Bind VolumeSlider.Value, Converter={StaticResource DecimalPointToPercentage}, Mode=OneWay}" x:Name="VolumeProgressText" RelativePanel.AlignRightWithPanel="True" RelativePanel.AlignVerticalCenterWithPanel="True" Margin="0,-2,10,0" />
                </RelativePanel>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>